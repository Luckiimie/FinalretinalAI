<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCT Analysis System</title>
    <meta name="description" content="AI-Powered OCT Analysis System for CNV Detection">
    <meta name="theme-color" content="#3b82f6">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIk9DVCBBbmFseXNpcyBTeXN0ZW0iLAogICJzaG9ydF9uYW1lIjogIk9DVCBBbmFseXNpcyIsCiAgImRlc2NyaXB0aW9uIjogIkFJLVBvd2VyZWQgT0NUIEFuYWx5c2lzIFN5c3RlbSBmb3IgQ05WIERldGVjdGlvbiIsCiAgInN0YXJ0X3VybCI6ICIvIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjZmZmZmZmIiwKICAidGhlbWVfY29sb3IiOiAiIzNiODJmNiIsCiAgIm9yaWVudGF0aW9uIjogInBvcnRyYWl0IiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTVRJNElpQm9aV2xuYUhROUlqRXlPQ0lnZG1sbGQwSnZlRDBpTUNBd0lERXlPQ0F4TWpnaUlIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJK1BHUmxabk0rUEdkcFlXUnBaVzUwSUdsa1BTSmhJaUJqZUQwaU5qUWlJR041UFNJMk5DSWdjakE5SWpJNElpQm1lRDBpTGpNaUlHWjVQU0l1TXlJZ1puQnlQU0l1TXlJK1BITjBiM0FnYjJabWMyVjBQU0l3SlNJZ2MzUnZjQzFqYjJ4dmNqMGlJek0zT0RkbVppSXZQand2WjNKaFpHbGxiblErUEdOcGNtTnNaU0JqZUQwaU5qUWlJR041UFNJMk5DSWdjakE5SWpJNElpQm1hV3hzUFNKMWNtd29JR0VwSWk4K1BIUmxlSFFnZUQwaU5qUWlJSGs5SWpjMklpQjBlWFJoYm1Ob2NqMGliV2xrWkd4bElpQm1hV3hzUFNKM2FHbDBaU0lnWm05dWRDMXphWHBsUFNJeU1DSWdabTl1ZEMxM1pXbG5hSFE5SWpjd01DSStQSE4yWnlCM2FXUjBhRDBpTVRZaUlHaGxhV2RvZEQwaU1UWWlJSFpwWlhkQ2IzZzlJakFnTUNBeE5pQXhOaUlnZUcxc2JuTTlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5Mekl3TURBdmMzWm5JajQ4Y0dGMGFDQmtQU0p0T0M0eE5pQTJMakEwUXpndU1UWWdNaTQzTWlBeUxqY3lJRGd1TVRZdE1pNDNNaUE0TGpFMlV6RXpMalEwSURZdU1EUWdPQzR4TmlBMkxqQTBlaUlnWm1sc2JEMGlJek0zT0RkbVppSXZQand2YzNablBqd3ZkR1Y0ZEQ0OEwyUmxabk0rUEM5emRtYysiLAogICAgICAic2l6ZXMiOiAiMTI4eDEyOCIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9LAogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU5URXlJaUJvWldsbmFIUTlJalV4TWlJZ2RtbGxkMEp2ZUQwaU1DQXdJRFV4TWlBMU1USWlJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SStQR1JsWm5NK1BHZHlZV1JwWlc1MElHbGtQU0poSWlCamVEMGlNalUySWlCamVUMGlNalUySWlCeVBTSnVNVEV5SWlCbWVEMGlMak1pSUdaNVBTSXVNeUlnWm5CeVBTSXVNeUkrUEhOMGIzQWdiMlptYzJWMFBTSXdKU0lnYzNSdmNDMWpiMnh2Y2owaUl6TTNNRGRHWMLRZ1BqdzJaM0poWkdsbGJuUStQR05wY21Oc1pTQmplRDBpTWpVMklpQmplVDBpTWpVMklpQnlQU0p1TVRFeUlpQm1hV3hzUFNKMWNtd29JR0VwSWk4K1BIUmxlSFFnZUQwaU1qVTJJaUI1UFNJek1EQWlJSFI1ZEdGdVkyaHlQU0p0YVdSa2JHVWlJR1pwYkd3OUluZG9hWFJsSWlCbWIyNTBMWE5wZW1VOUlqUTRJaUJtYjI1MExYZGxhV2RvZEQwaU56QXdJajQ4YzNablozZHBaSFJvUFNJek1pSWdhR1ZwWjJoMFBTSXpNaUlnZG1sbGQwSnZlRDBpTUNBd0lETXlJRE15SWlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpUGp4d1lYUm9JR1E5SW0wNExqRTJJRFlnUXpndU1UWWdNaTQzTWlBeUxqY3lJRGd1TVRZdE1pNDNNaUE0TGpFMlV6RXpMalEwSURZZ09DNHhOaUEyZWlJZ1ptbHNiRDBpSXpNM09EZG1aaUl2UGp3dmMzWm5Qand2ZEdWNGRENDhMMlJsWm5NK1BDOXpkbWMrIiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0sCiAgImNhdGVnb3JpZXMiOiBbIm1lZGljYWwiLCAiaGVhbHRoY2FyZSIsICJhaS1hbmFseXNpcyJdCn0=">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .upload-area.dragover { border-color: #dc2626; background-color: #fef2f2; }
        .confidence-circle { transition: stroke-dashoffset 0.5s ease-in-out; }
        .section-content { display: none; }
        .section-content.active { display: block; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen">
    <!-- Navigation Header -->
    <header class="bg-white shadow-sm" id="mainHeader" style="display: none;">
        <div class="max-w-6xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold">üëÅÔ∏è</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-slate-800">OCT Analysis System</h1>
                        <p class="text-sm text-slate-600">AI-Powered CNV Detection</p>
                    </div>
                </div>
                
                <!-- Navigation Menu -->
                <nav class="flex items-center space-x-4">
                    <button class="nav-btn px-4 py-2 rounded-lg font-medium transition-colors" data-section="dashboard">
                        üìä Dashboard
                    </button>
                    <button class="nav-btn px-4 py-2 rounded-lg font-medium transition-colors" data-section="upload">
                        üìÅ New Upload
                    </button>
                    <button class="nav-btn px-4 py-2 rounded-lg font-medium transition-colors" data-section="history">
                        üìã Patient History
                    </button>
                    <button id="installBtn" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg font-medium hover:from-green-600 hover:to-green-700 transition-colors" style="display: none;">
                        üì± Install App
                    </button>
                    <button class="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-4 py-2 rounded-lg font-medium hover:from-blue-600 hover:to-purple-600 transition-colors" onclick="logout()">
                        üö™ Logout
                    </button>
                </nav>
                
                <div class="flex items-center space-x-2 bg-gray-100 px-4 py-2 rounded-full" id="statusIndicator">
                    <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                    <span class="text-gray-800 font-medium">Ready for Analysis</span>
                </div>
                
                <!-- Offline Notification -->
                <div id="offlineNotification" class="fixed top-4 right-4 bg-orange-500 text-white px-4 py-2 rounded-lg shadow-lg z-50" style="display: none;">
                    <div class="flex items-center space-x-2">
                        <span>üì°</span>
                        <span>Working Offline</span>
                    </div>
                </div>
                
                <!-- Update Available Notification -->
                <div id="updateNotification" class="fixed top-4 right-4 bg-blue-500 text-white px-4 py-3 rounded-lg shadow-lg z-50" style="display: none;">
                    <div class="flex items-center justify-between space-x-4">
                        <div class="flex items-center space-x-2">
                            <span>üîÑ</span>
                            <span>Update Available</span>
                        </div>
                        <button id="updateBtn" class="bg-white text-blue-500 px-3 py-1 rounded text-sm font-medium hover:bg-blue-50">
                            Update
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Login Section -->
    <section id="loginSection" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-500 via-purple-500 to-purple-600">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-400 rounded-2xl flex items-center justify-center mx-auto mb-4">
                    <span class="text-2xl">üëÅÔ∏è</span>
                </div>
                <h2 class="text-2xl font-bold text-slate-800">OCT Analysis System</h2>
                <p class="text-slate-600">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</p>
            </div>
            
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Username</label>
                    <input type="text" id="username" class="w-full px-4 py-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400" placeholder="Enter username" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Password</label>
                    <input type="password" id="password" class="w-full px-4 py-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400" placeholder="Enter password" required>
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-600 transition-colors">
                    ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </form>
            
            <div class="mt-6 text-center text-sm text-slate-500">
                <p>Demo: username: <strong>doctor</strong>, password: <strong>123456</strong></p>
            </div>
        </div>
    </section>

    <!-- Main Content Container -->
    <div id="mainContent" style="display: none;">
        
        <!-- Dashboard Section (Version 20 Style) -->
        <section id="dashboardSection" class="section-content max-w-6xl mx-auto px-4 py-8">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-slate-800 mb-2">Dashboard</h2>
                <p class="text-slate-600">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</p>
            </div>
            
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-gradient-to-br from-blue-100 to-purple-100 rounded-lg flex items-center justify-center">
                            <span class="text-2xl">üìä</span>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-slate-600">Total Analyses</p>
                            <p class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent" id="totalAnalyses">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                            <span class="text-2xl">‚ö†Ô∏è</span>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-slate-600">CNV Detected</p>
                            <p class="text-2xl font-bold text-orange-600" id="cnvDetected">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center">
                            <span class="text-2xl">‚úÖ</span>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-slate-600">Normal Results</p>
                            <p class="text-2xl font-bold text-emerald-600" id="normalResults">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                            <span class="text-2xl">üéØ</span>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-slate-600">Avg Confidence</p>
                            <p class="text-2xl font-bold text-blue-600" id="avgConfidence">0%</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
                <h3 class="text-lg font-semibold text-slate-800 mb-4">Quick Actions</h3>
                <div class="flex space-x-4">
                    <button class="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-8 py-4 rounded-lg font-bold hover:from-blue-600 hover:to-purple-600 transition-colors" onclick="showSection('upload')">
                        üìÅ New Analysis
                    </button>
                    <button class="bg-gradient-to-r from-blue-100 to-purple-100 text-blue-700 px-8 py-4 rounded-lg font-semibold hover:from-blue-200 hover:to-purple-200 transition-colors" onclick="showSection('history')">
                        üìã View History
                    </button>
                </div>
            </div>
            
            <!-- Recent Analyses -->
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h3 class="text-lg font-semibold text-slate-800 mb-4">Recent Analyses</h3>
                <div id="recentAnalyses" class="space-y-4">
                    <div class="text-center text-slate-500 py-8">
                        <div class="text-4xl mb-2">üìä</div>
                        <p>No analyses yet. Start by uploading an OCT image.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Upload Section (Version 9 Style) -->
        <section id="uploadSection" class="section-content max-w-6xl mx-auto px-4 py-8">
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                <div class="upload-area p-12 text-center border-2 border-dashed border-blue-300 m-6 rounded-xl hover:border-purple-400 hover:bg-gradient-to-br hover:from-blue-50 hover:to-purple-50 transition-all cursor-pointer" id="uploadArea">
                    <div class="text-6xl mb-4">üìÅ</div>
                    <h3 class="text-2xl font-semibold mb-2 text-slate-800">Upload OCT Image</h3>
                    <p class="text-slate-600 mb-6">Drag and drop your OCT B-Scan image here or click to browse</p>
                    <input type="file" id="imageInput" accept="image/*" hidden>
                    <button class="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-8 py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-600 transition-colors" id="uploadBtn">
                        Choose File
                    </button>
                </div>
            </div>
        </section>

        <!-- Results Section (Version 9 Style) -->
        <section id="resultsSection" class="section-content max-w-6xl mx-auto px-4 py-8">
            <!-- Main Result Card -->
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-8">
                <!-- Patient Info -->
                <div class="bg-gradient-to-r from-red-50 to-pink-50 px-6 py-4 border-b">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-lg font-semibold text-gray-900" id="patientInfo">Patient Analysis</h2>
                            <p class="text-sm text-gray-600" id="analysisTime">Processing...</p>
                        </div>
                        <div class="text-right" id="resultStatus">
                            <p class="text-2xl font-bold text-gray-600">PROCESSING</p>
                            <p class="text-sm text-gray-600">Please wait</p>
                        </div>
                    </div>
                </div>

                <!-- OCT Image with Analysis -->
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">OCT B-Scan Analysis</h3>
                        <div class="flex items-center space-x-2 bg-yellow-100 px-3 py-1 rounded-full" id="analysisBadge">
                            <span class="text-yellow-600 text-sm font-medium">‚è≥ Analyzing...</span>
                        </div>
                    </div>

                    <!-- OCT Image Display -->
                    <div class="relative bg-black rounded-xl overflow-hidden">
                        <img id="uploadedImage" src="" alt="Uploaded OCT Image" class="w-full h-96 object-contain bg-black rounded-xl" style="display: none;">
                        
                        <div id="imagePlaceholder" class="w-full h-96 bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center">
                            <div class="text-center text-white">
                                <div class="text-6xl mb-4">üñºÔ∏è</div>
                                <p class="text-lg font-medium">Uploaded OCT Image</p>
                                <p class="text-sm opacity-75">Your uploaded image will display here</p>
                            </div>
                        </div>

                        <!-- Image Labels -->
                        <div class="absolute top-4 left-4 bg-black bg-opacity-70 text-white px-3 py-2 rounded">
                            <p class="text-sm font-medium">OCT B-Scan ‚Ä¢ Macular Region</p>
                            <p class="text-xs opacity-80">6mm scan ‚Ä¢ High resolution</p>
                        </div>

                        <div class="absolute top-4 right-4 bg-yellow-600 text-white px-3 py-2 rounded font-bold" id="detectionLabel">
                            ANALYZING...
                        </div>

                        <div class="absolute bottom-4 right-4 bg-black bg-opacity-70 text-white px-3 py-2 rounded">
                            <p class="text-xs" id="confidenceLabel">AI Confidence: <span class="font-bold text-yellow-400">---%</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analysis Results Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Confidence Score -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4 text-center">AI Confidence Score</h3>
                    <div class="flex justify-center mb-4">
                        <div class="relative w-32 h-32">
                            <svg class="confidence-ring w-32 h-32" viewBox="0 0 100 100" style="transform: rotate(-90deg);">
                                <circle cx="50" cy="50" r="45" stroke="#e5e7eb" stroke-width="8" fill="none"/>
                                <circle cx="50" cy="50" r="45" stroke="#10b981" stroke-width="8" fill="none" 
                                        class="confidence-circle" id="confidenceCircle" style="stroke-dasharray: 283; stroke-dashoffset: 283; transition: stroke-dashoffset 0.5s ease-in-out;"/>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-green-600" id="confidencePercentage">0%</div>
                                    <div class="text-xs text-gray-500">Confidence</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="text-center" id="confidenceStatus">
                        <div class="inline-flex items-center px-3 py-1 bg-gray-100 text-gray-800 rounded-full text-sm font-medium">
                            ‚è≥ Processing...
                        </div>
                        <p class="text-xs text-gray-600 mt-2">Analyzing image data</p>
                    </div>
                </div>

                <!-- Detection Results -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Detection Results</h3>
                    <div class="space-y-4" id="detectionResults">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div>
                                <p class="font-medium text-gray-800">Analysis Status</p>
                                <p class="text-sm text-gray-600">Processing...</p>
                            </div>
                            <div class="w-3 h-3 bg-gray-400 rounded-full"></div>
                        </div>
                    </div>
                </div>

                <!-- Recommended Actions -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Recommended Actions</h3>
                    <div class="space-y-3" id="recommendationsList">
                        <div class="p-3 bg-gray-50 border-l-4 border-gray-400 rounded">
                            <p class="font-medium text-gray-800 text-sm">‚è≥ Analysis in Progress</p>
                            <p class="text-xs text-gray-600">Please wait for results</p>
                        </div>
                    </div>

                    <div class="mt-4 space-y-2">
                        <button class="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white py-2 px-4 rounded-lg font-medium hover:from-blue-600 hover:to-purple-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" id="downloadBtn" disabled>
                            üìÑ Download Report
                        </button>
                        <button class="w-full bg-gradient-to-r from-blue-100 to-purple-100 text-blue-700 py-3 px-4 rounded-lg font-bold hover:from-blue-200 hover:to-purple-200 transition-colors" id="newAnalysisBtn">
                            üîÑ New Analysis
                        </button>
                    </div>
                </div>
            </div>

            <!-- Summary Banner -->
            <div class="mt-8 bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl p-6 text-white" id="summaryBanner">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-xl font-bold mb-2" id="summaryTitle">üìä Analysis Summary</h3>
                        <p class="text-blue-100" id="summaryText">
                            Analysis results will appear here after processing.
                        </p>
                    </div>
                    <div class="text-right">
                        <button class="bg-white text-red-600 px-6 py-3 rounded-lg font-semibold hover:bg-red-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" id="summaryDownloadBtn" disabled>
                            üìÑ Download Report
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Patient History Section -->
        <section id="historySection" class="section-content max-w-6xl mx-auto px-4 py-8">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-slate-800 mb-2">Patient History</h2>
                <p class="text-slate-600">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
            </div>
            
            <!-- History Filters -->
            <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                <div class="flex items-center space-x-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Filter by Result</label>
                        <select id="historyFilter" class="px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-400">
                            <option value="all">All Results</option>
                            <option value="cnv">CNV Detected</option>
                            <option value="normal">Normal</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Sort by</label>
                        <select id="historySort" class="px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-400">
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                            <option value="confidence">Highest Confidence</option>
                        </select>
                    </div>
                    <div class="flex-1"></div>
                    <button class="bg-slate-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-slate-700 transition-colors" onclick="clearHistory()">
                        üóëÔ∏è Clear History
                    </button>
                </div>
            </div>
            
            <!-- History List -->
            <div id="historyList" class="space-y-4">
                <div class="text-center text-slate-500 py-12">
                    <div class="text-6xl mb-4">üìã</div>
                    <p class="text-lg">No analysis history found</p>
                    <p class="text-sm">Start analyzing OCT images to see history here</p>
                </div>
            </div>
        </section>
    </div>

    <script>
        class OCTAnalyzer {
            constructor() {
                this.patientHistory = JSON.parse(localStorage.getItem('octHistory') || '[]');
                this.currentSection = 'login';
                this.isLoggedIn = false;
                this.currentAnalysis = null;
                this.initializeElements();
                this.setupEventListeners();
                this.updateDashboardStats();
            }

            initializeElements() {
                // Login elements
                this.loginSection = document.getElementById('loginSection');
                this.loginForm = document.getElementById('loginForm');
                this.mainContent = document.getElementById('mainContent');
                this.mainHeader = document.getElementById('mainHeader');
                
                // Navigation elements
                this.navButtons = document.querySelectorAll('.nav-btn');
                
                // Section elements
                this.dashboardSection = document.getElementById('dashboardSection');
                this.uploadSection = document.getElementById('uploadSection');
                this.resultsSection = document.getElementById('resultsSection');
                this.historySection = document.getElementById('historySection');
                
                // Upload elements
                this.uploadArea = document.getElementById('uploadArea');
                this.imageInput = document.getElementById('imageInput');
                this.uploadBtn = document.getElementById('uploadBtn');
                
                // Display elements
                this.uploadedImage = document.getElementById('uploadedImage');
                this.imagePlaceholder = document.getElementById('imagePlaceholder');
                
                // Status elements
                this.statusIndicator = document.getElementById('statusIndicator');
                this.analysisBadge = document.getElementById('analysisBadge');
                this.detectionLabel = document.getElementById('detectionLabel');
                this.confidenceLabel = document.getElementById('confidenceLabel');
                
                // Result elements
                this.patientInfo = document.getElementById('patientInfo');
                this.analysisTime = document.getElementById('analysisTime');
                this.resultStatus = document.getElementById('resultStatus');
                this.confidencePercentage = document.getElementById('confidencePercentage');
                this.confidenceCircle = document.getElementById('confidenceCircle');
                this.confidenceStatus = document.getElementById('confidenceStatus');
                this.detectionResults = document.getElementById('detectionResults');
                this.recommendationsList = document.getElementById('recommendationsList');
                
                // Summary elements
                this.summaryTitle = document.getElementById('summaryTitle');
                this.summaryText = document.getElementById('summaryText');
                
                // Action buttons
                this.downloadBtn = document.getElementById('downloadBtn');
                this.newAnalysisBtn = document.getElementById('newAnalysisBtn');
                this.summaryDownloadBtn = document.getElementById('summaryDownloadBtn');
                
                // Dashboard elements
                this.totalAnalyses = document.getElementById('totalAnalyses');
                this.cnvDetected = document.getElementById('cnvDetected');
                this.normalResults = document.getElementById('normalResults');
                this.avgConfidence = document.getElementById('avgConfidence');
                this.recentAnalyses = document.getElementById('recentAnalyses');
                
                // History elements
                this.historyFilter = document.getElementById('historyFilter');
                this.historySort = document.getElementById('historySort');
                this.historyList = document.getElementById('historyList');
            }

            setupEventListeners() {
                // Login form
                if (this.loginForm) {
                    this.loginForm.addEventListener('submit', (e) => this.handleLogin(e));
                }
                
                // Navigation buttons
                this.navButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const section = e.target.getAttribute('data-section');
                        this.showSection(section);
                    });
                });
                
                // Upload events
                if (this.uploadBtn) this.uploadBtn.addEventListener('click', () => this.imageInput.click());
                if (this.imageInput) this.imageInput.addEventListener('change', (e) => this.handleFileSelect(e));
                
                // Drag and drop events
                if (this.uploadArea) {
                    this.uploadArea.addEventListener('dragover', (e) => this.handleDragOver(e));
                    this.uploadArea.addEventListener('dragleave', (e) => this.handleDragLeave(e));
                    this.uploadArea.addEventListener('drop', (e) => this.handleDrop(e));
                    this.uploadArea.addEventListener('click', () => this.imageInput.click());
                }
                
                // Action buttons
                if (this.newAnalysisBtn) this.newAnalysisBtn.addEventListener('click', () => this.resetToUpload());
                if (this.downloadBtn) this.downloadBtn.addEventListener('click', () => this.downloadReport());
                if (this.summaryDownloadBtn) this.summaryDownloadBtn.addEventListener('click', () => this.downloadReport());
                
                // History filters
                if (this.historyFilter) this.historyFilter.addEventListener('change', () => this.updateHistoryDisplay());
                if (this.historySort) this.historySort.addEventListener('change', () => this.updateHistoryDisplay());
            }

            handleLogin(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                // Simple demo authentication
                if (username === 'doctor' && password === '123456') {
                    this.isLoggedIn = true;
                    this.loginSection.style.display = 'none';
                    this.mainContent.style.display = 'block';
                    this.mainHeader.style.display = 'block';
                    this.showSection('upload');
                } else {
                    alert('Invalid credentials. Use username: doctor, password: 123456');
                }
            }

            showSection(section) {
                // Hide all sections
                this.dashboardSection.style.display = 'none';
                this.uploadSection.style.display = 'none';
                this.resultsSection.style.display = 'none';
                this.historySection.style.display = 'none';
                
                // Update navigation buttons
                this.navButtons.forEach(btn => {
                    btn.classList.remove('bg-red-600', 'text-white');
                    btn.classList.add('text-gray-700', 'hover:bg-gray-100');
                });
                
                // Show selected section
                const activeBtn = document.querySelector(`[data-section="${section}"]`);
                if (activeBtn) {
                    activeBtn.classList.remove('text-gray-700', 'hover:bg-gray-100');
                    activeBtn.classList.add('bg-red-600', 'text-white');
                }
                
                switch(section) {
                    case 'dashboard':
                        this.dashboardSection.style.display = 'block';
                        this.updateDashboardStats();
                        break;
                    case 'upload':
                        this.uploadSection.style.display = 'block';
                        break;
                    case 'history':
                        this.historySection.style.display = 'block';
                        this.updateHistoryDisplay();
                        break;
                }
                
                this.currentSection = section;
            }

            handleDragOver(e) {
                e.preventDefault();
                this.uploadArea.classList.add('dragover');
            }

            handleDragLeave(e) {
                e.preventDefault();
                this.uploadArea.classList.remove('dragover');
            }

            handleDrop(e) {
                e.preventDefault();
                this.uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    this.processFile(files[0]);
                }
            }

            handleFileSelect(e) {
                const file = e.target.files[0];
                if (file) {
                    this.processFile(file);
                }
            }

            processFile(file) {
                if (!file.type.startsWith('image/')) {
                    alert('Please select an image file');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    this.uploadedImage.src = e.target.result;
                    this.uploadedImage.style.display = 'block';
                    this.imagePlaceholder.style.display = 'none';
                    this.showResults();
                    this.startAnalysis();
                };
                reader.readAsDataURL(file);
            }

            showResults() {
                this.uploadSection.style.display = 'none';
                this.resultsSection.style.display = 'block';
                
                // Update patient info
                const now = new Date();
                const patientId = 'P' + String(Math.floor(Math.random() * 100000)).padStart(5, '0');
                this.patientInfo.textContent = `Patient ${patientId} ‚Ä¢ Analysis`;
                this.analysisTime.textContent = `${now.toLocaleDateString('th-TH')} ‚Ä¢ ${now.toLocaleTimeString('th-TH', {hour: '2-digit', minute: '2-digit'})} ‚Ä¢ Processing...`;
                
                // Initialize current analysis
                this.currentAnalysis = {
                    id: Date.now(),
                    patientId: patientId,
                    timestamp: now,
                    imageData: this.uploadedImage.src
                };
            }

            startAnalysis() {
                // Update status to analyzing
                this.updateStatus('analyzing', 'Analyzing Image...');
                this.detectionLabel.textContent = 'ANALYZING...';
                this.detectionLabel.className = 'absolute top-4 right-4 bg-yellow-600 text-white px-3 py-2 rounded font-bold';
                
                // Reset confidence
                this.updateConfidence(0, 'Processing...');
                
                // Simulate AI analysis process
                this.simulateAnalysis();
            }

            simulateAnalysis() {
                // Simulate processing time (2-5 seconds)
                const processingTime = 2000 + Math.random() * 3000;
                
                // Show progress
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += Math.random() * 15;
                    if (progress > 95) progress = 95;
                    
                    this.updateConfidence(progress, 'Analyzing...');
                    this.confidenceLabel.innerHTML = `AI Confidence: <span class="font-bold text-yellow-400">${progress.toFixed(1)}%</span>`;
                }, 200);

                setTimeout(() => {
                    clearInterval(progressInterval);
                    this.completeAnalysis();
                }, processingTime);
            }

            completeAnalysis() {
                // Generate random results (simulate AI model output)
                const results = this.generateAnalysisResults();
                
                // Update current analysis with results
                this.currentAnalysis = {
                    ...this.currentAnalysis,
                    ...results,
                    completedAt: new Date()
                };
                
                // Update all UI elements with results
                this.updateStatus(results.hasDetection ? 'detected' : 'normal', results.hasDetection ? 'CNV DETECTED' : 'NO CNV DETECTED');
                this.updateConfidence(results.confidence, results.confidenceLevel);
                this.updateDetectionResults(results);
                this.updateRecommendations(results);
                this.updateSummary(results);
                
                // Update labels
                this.detectionLabel.textContent = results.hasDetection ? 'CNV DETECTED' : 'NORMAL';
                this.detectionLabel.className = `absolute top-4 right-4 ${results.hasDetection ? 'bg-red-600' : 'bg-green-500'} text-white px-3 py-2 rounded font-bold`;
                
                this.confidenceLabel.innerHTML = `AI Confidence: <span class="font-bold text-green-400">${results.confidence.toFixed(1)}%</span>`;
                
                // Update analysis time
                const now = new Date();
                this.analysisTime.textContent = `${now.toLocaleDateString('th-TH')} ‚Ä¢ ${now.toLocaleTimeString('th-TH', {hour: '2-digit', minute: '2-digit'})} ‚Ä¢ Analysis completed`;
                
                // Enable download button
                if (this.downloadBtn) this.downloadBtn.disabled = false;
                if (this.summaryDownloadBtn) this.summaryDownloadBtn.disabled = false;
                
                // Save to history
                this.saveToHistory(this.currentAnalysis);
                
                // Send push notification if supported
                if (window.pwaManager) {
                    const message = results.hasDetection ? 
                        `CNV detected with ${results.confidence.toFixed(1)}% confidence` : 
                        `Analysis complete - Normal result (${results.confidence.toFixed(1)}% confidence)`;
                    window.pwaManager.showNotification(message, results.hasDetection ? 'warning' : 'success');
                }
                
                // If offline, save to offline queue
                if (window.pwaManager && !window.pwaManager.isOnline) {
                    window.pwaManager.saveOfflineAnalysis(this.currentAnalysis);
                }
            }

            generateAnalysisResults() {
                // Simulate AI model results
                const confidence = 70 + Math.random() * 30; // 70-100%
                const hasDetection = Math.random() > 0.3; // 70% chance of detection
                
                const diseases = [
                    'Choroidal Neovascularization (CNV)',
                    'Diabetic Macular Edema',
                    'Age-related Macular Degeneration',
                    'Macular Hole',
                    'Epiretinal Membrane'
                ];
                
                const detectedDisease = hasDetection ? diseases[Math.floor(Math.random() * diseases.length)] : null;
                
                return {
                    hasDetection,
                    confidence,
                    confidenceLevel: confidence > 90 ? 'High Confidence (>90%)' : confidence > 70 ? 'Medium Confidence (70-90%)' : 'Low Confidence (<70%)',
                    detectedDisease,
                    riskLevel: hasDetection ? (confidence > 85 ? 'High Risk' : 'Medium Risk') : 'Low Risk'
                };
            }

            updateStatus(type, text) {
                let statusClass = 'flex items-center space-x-2 px-4 py-2 rounded-full';
                let dotClass = 'w-3 h-3 rounded-full animate-pulse';
                
                if (type === 'analyzing') {
                    statusClass += ' bg-yellow-100';
                    dotClass += ' bg-yellow-500';
                    this.statusIndicator.innerHTML = `<div class="${dotClass}"></div><span class="text-yellow-800 font-medium">${text}</span>`;
                } else if (type === 'detected') {
                    statusClass += ' bg-red-100';
                    dotClass += ' bg-red-500';
                    this.statusIndicator.innerHTML = `<div class="${dotClass}"></div><span class="text-red-800 font-medium">${text}</span>`;
                    this.resultStatus.innerHTML = `
                        <p class="text-2xl font-bold text-red-600">CNV</p>
                        <p class="text-sm text-gray-600">Positive</p>
                    `;
                } else if (type === 'normal') {
                    statusClass += ' bg-green-100';
                    dotClass += ' bg-green-500';
                    this.statusIndicator.innerHTML = `<div class="${dotClass}"></div><span class="text-green-800 font-medium">${text}</span>`;
                    this.resultStatus.innerHTML = `
                        <p class="text-2xl font-bold text-green-600">NORMAL</p>
                        <p class="text-sm text-gray-600">Negative</p>
                    `;
                }
                
                this.statusIndicator.className = statusClass;
                
                // Update analysis badge
                if (type === 'analyzing') {
                    this.analysisBadge.innerHTML = `<span class="text-yellow-600 text-sm font-medium">‚è≥ ${text}</span>`;
                } else if (type === 'detected') {
                    this.analysisBadge.innerHTML = `<span class="text-red-600 text-sm font-medium">‚ö†Ô∏è CNV Areas Detected</span>`;
                } else {
                    this.analysisBadge.innerHTML = `<span class="text-green-600 text-sm font-medium">‚úÖ Normal Result</span>`;
                }
            }

            updateConfidence(percentage, status) {
                this.confidencePercentage.textContent = `${percentage.toFixed(1)}%`;
                
                // Update circle
                const circumference = 2 * Math.PI * 45;
                const offset = circumference - (percentage / 100) * circumference;
                this.confidenceCircle.style.strokeDashoffset = offset;
                
                // Update status badge
                let badgeClass = 'inline-flex items-center px-3 py-1 rounded-full text-sm font-medium';
                let badgeText = status;
                
                if (percentage >= 90) {
                    badgeClass += ' bg-green-100 text-green-800';
                    badgeText = '‚úÖ High Confidence (>90%)';
                } else if (percentage >= 70) {
                    badgeClass += ' bg-yellow-100 text-yellow-800';
                    badgeText = '‚ö†Ô∏è Medium Confidence (70-90%)';
                } else if (percentage > 0) {
                    badgeClass += ' bg-red-100 text-red-800';
                    badgeText = '‚ö†Ô∏è Low Confidence (<70%)';
                } else {
                    badgeClass += ' bg-gray-100 text-gray-800';
                    badgeText = '‚è≥ Processing...';
                }
                
                this.confidenceStatus.innerHTML = `
                    <div class="${badgeClass}">${badgeText}</div>
                    <p class="text-xs text-gray-600 mt-2">${percentage > 0 ? 'Analysis complete' : 'Analyzing image data'}</p>
                `;
            }

            updateDetectionResults(results) {
                let resultsHTML = '';
                
                if (results.hasDetection) {
                    resultsHTML += `
                        <div class="flex items-center justify-between p-3 bg-red-50 rounded-lg">
                            <div>
                                <p class="font-medium text-red-800">Disease Detected</p>
                                <p class="text-sm text-red-600">${results.detectedDisease}</p>
                            </div>
                            <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                        </div>
                    `;
                    
                    resultsHTML += `
                        <div class="flex items-center justify-between p-3 bg-orange-50 rounded-lg">
                            <div>
                                <p class="font-medium text-orange-800">Risk Level</p>
                                <p class="text-sm text-orange-600">${results.riskLevel}</p>
                            </div>
                            <div class="w-3 h-3 bg-orange-500 rounded-full"></div>
                        </div>
                    `;
                } else {
                    resultsHTML = `
                        <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                            <div>
                                <p class="font-medium text-green-800">Analysis Result</p>
                                <p class="text-sm text-green-600">No abnormalities detected</p>
                            </div>
                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                        </div>
                    `;
                }
                
                this.detectionResults.innerHTML = resultsHTML;
            }

            updateRecommendations(results) {
                let recommendationsHTML = '';
                
                if (results.hasDetection) {
                    if (results.confidence > 85) {
                        recommendationsHTML += `
                            <div class="p-3 bg-red-50 border-l-4 border-red-500 rounded">
                                <p class="font-medium text-red-800 text-sm">üö® Urgent Referral</p>
                                <p class="text-xs text-red-600">Retina specialist consultation</p>
                            </div>
                        `;
                    }
                    
                    if (results.detectedDisease.includes('CNV')) {
                        recommendationsHTML += `
                            <div class="p-3 bg-blue-50 border-l-4 border-blue-500 rounded">
                                <p class="font-medium text-blue-800 text-sm">üíâ Treatment Ready</p>
                                <p class="text-xs text-blue-600">Anti-VEGF injection indicated</p>
                            </div>
                        `;
                    }
                    
                    recommendationsHTML += `
                        <div class="p-3 bg-green-50 border-l-4 border-green-500 rounded">
                            <p class="font-medium text-green-800 text-sm">üìä Report Generated</p>
                            <p class="text-xs text-green-600">Ready for physician review</p>
                        </div>
                    `;
                } else {
                    recommendationsHTML = `
                        <div class="p-3 bg-green-50 border-l-4 border-green-500 rounded">
                            <p class="font-medium text-green-800 text-sm">‚úÖ Normal Result</p>
                            <p class="text-xs text-green-600">Continue routine examinations</p>
                        </div>
                    `;
                }
                
                this.recommendationsList.innerHTML = recommendationsHTML;
            }

            updateSummary(results) {
                if (results.hasDetection) {
                    this.summaryTitle.textContent = '‚ö†Ô∏è CNV Detection Summary';
                    this.summaryText.textContent = `${results.detectedDisease} detected with ${results.confidence.toFixed(1)}% confidence. ${results.confidence > 85 ? 'Immediate ophthalmologist consultation recommended.' : 'Further evaluation recommended.'}`;
                } else {
                    this.summaryTitle.textContent = '‚úÖ Analysis Summary';
                    this.summaryText.textContent = `No abnormalities detected with ${results.confidence.toFixed(1)}% confidence. Continue regular eye examinations as recommended by your healthcare provider.`;
                }
            }

            resetToUpload() {
                // Show dashboard (Version 20 style) after clicking New Analysis
                this.showSection('dashboard');
                
                // Reset form
                this.imageInput.value = '';
                this.uploadedImage.src = '';
                this.uploadedImage.style.display = 'none';
                this.imagePlaceholder.style.display = 'flex';
                
                // Reset status
                this.statusIndicator.className = 'flex items-center space-x-2 bg-gray-100 px-4 py-2 rounded-full';
                this.statusIndicator.innerHTML = `
                    <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                    <span class="text-gray-800 font-medium">Ready for Analysis</span>
                `;
                
                // Disable buttons
                if (this.downloadBtn) this.downloadBtn.disabled = true;
                if (this.summaryDownloadBtn) this.summaryDownloadBtn.disabled = true;
                
                // Reset confidence
                this.updateConfidence(0, 'Ready for analysis');
                
                // Update dashboard stats
                this.updateDashboardStats();
            }

            saveToHistory(analysis) {
                this.patientHistory.unshift(analysis);
                localStorage.setItem('octHistory', JSON.stringify(this.patientHistory));
                this.updateDashboardStats();
            }

            updateDashboardStats() {
                const total = this.patientHistory.length;
                const cnvCount = this.patientHistory.filter(a => a.hasDetection).length;
                const normalCount = total - cnvCount;
                const avgConf = total > 0 ? this.patientHistory.reduce((sum, a) => sum + (a.confidence || 0), 0) / total : 0;
                
                if (this.totalAnalyses) this.totalAnalyses.textContent = total;
                if (this.cnvDetected) this.cnvDetected.textContent = cnvCount;
                if (this.normalResults) this.normalResults.textContent = normalCount;
                if (this.avgConfidence) this.avgConfidence.textContent = `${avgConf.toFixed(1)}%`;
                
                // Update recent analyses
                this.updateRecentAnalyses();
            }

            updateRecentAnalyses() {
                if (!this.recentAnalyses) return;
                
                const recent = this.patientHistory.slice(0, 5);
                
                if (recent.length === 0) {
                    this.recentAnalyses.innerHTML = `
                        <div class="text-center text-gray-500 py-8">
                            <div class="text-4xl mb-2">üìä</div>
                            <p>No analyses yet. Start by uploading an OCT image.</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                recent.forEach(analysis => {
                    const date = new Date(analysis.timestamp).toLocaleDateString('th-TH');
                    const time = new Date(analysis.timestamp).toLocaleTimeString('th-TH', {hour: '2-digit', minute: '2-digit'});
                    
                    html += `
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-gray-200 rounded-lg overflow-hidden">
                                    <img src="${analysis.imageData}" alt="OCT" class="w-full h-full object-cover">
                                </div>
                                <div>
                                    <p class="font-medium text-gray-900">${analysis.patientId}</p>
                                    <p class="text-sm text-gray-600">${date} ‚Ä¢ ${time}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${analysis.hasDetection ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                                    ${analysis.hasDetection ? '‚ö†Ô∏è CNV' : '‚úÖ Normal'}
                                </div>
                                <p class="text-sm text-gray-600 mt-1">${analysis.confidence?.toFixed(1)}% confidence</p>
                            </div>
                        </div>
                    `;
                });
                
                this.recentAnalyses.innerHTML = html;
            }

            updateHistoryDisplay() {
                if (!this.historyList) return;
                
                let filteredHistory = [...this.patientHistory];
                
                // Apply filter
                const filter = this.historyFilter?.value || 'all';
                if (filter === 'cnv') {
                    filteredHistory = filteredHistory.filter(a => a.hasDetection);
                } else if (filter === 'normal') {
                    filteredHistory = filteredHistory.filter(a => !a.hasDetection);
                }
                
                // Apply sort
                const sort = this.historySort?.value || 'newest';
                if (sort === 'oldest') {
                    filteredHistory.reverse();
                } else if (sort === 'confidence') {
                    filteredHistory.sort((a, b) => (b.confidence || 0) - (a.confidence || 0));
                }
                
                if (filteredHistory.length === 0) {
                    this.historyList.innerHTML = `
                        <div class="text-center text-gray-500 py-12">
                            <div class="text-6xl mb-4">üìã</div>
                            <p class="text-lg">No analysis history found</p>
                            <p class="text-sm">Start analyzing OCT images to see history here</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                filteredHistory.forEach(analysis => {
                    const date = new Date(analysis.timestamp).toLocaleDateString('th-TH');
                    const time = new Date(analysis.timestamp).toLocaleTimeString('th-TH', {hour: '2-digit', minute: '2-digit'});
                    
                    html += `
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-start space-x-4">
                                <div class="w-20 h-20 bg-gray-200 rounded-lg overflow-hidden flex-shrink-0">
                                    <img src="${analysis.imageData}" alt="OCT" class="w-full h-full object-cover">
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between mb-2">
                                        <h3 class="text-lg font-semibold text-gray-900">${analysis.patientId}</h3>
                                        <div class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${analysis.hasDetection ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                                            ${analysis.hasDetection ? '‚ö†Ô∏è CNV Detected' : '‚úÖ Normal'}
                                        </div>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-2">${date} ‚Ä¢ ${time}</p>
                                    <div class="grid grid-cols-2 gap-4 text-sm">
                                        <div>
                                            <span class="text-gray-500">Confidence:</span>
                                            <span class="font-medium">${analysis.confidence?.toFixed(1)}%</span>
                                        </div>
                                        <div>
                                            <span class="text-gray-500">Risk Level:</span>
                                            <span class="font-medium">${analysis.riskLevel || 'N/A'}</span>
                                        </div>
                                    </div>
                                    ${analysis.detectedDisease ? `
                                        <div class="mt-2 text-sm">
                                            <span class="text-gray-500">Detected:</span>
                                            <span class="font-medium text-red-600">${analysis.detectedDisease}</span>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                this.historyList.innerHTML = html;
            }

            downloadReport() {
                if (!this.currentAnalysis) return;
                
                // Generate and download report
                const reportData = this.generateReportData();
                const blob = new Blob([reportData], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `OCT_Analysis_Report_${this.currentAnalysis.patientId}_${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            generateReportData() {
                if (!this.currentAnalysis) return '';
                
                const now = new Date();
                return `
OCT ANALYSIS REPORT
==================

Patient ID: ${this.currentAnalysis.patientId}
Analysis Date: ${now.toLocaleDateString('th-TH')}
Analysis Time: ${now.toLocaleTimeString('th-TH')}

ANALYSIS RESULTS:
- Status: ${this.currentAnalysis.hasDetection ? 'CNV DETECTED' : 'NORMAL'}
- Confidence: ${this.currentAnalysis.confidence?.toFixed(1)}%
- Risk Level: ${this.currentAnalysis.riskLevel}
${this.currentAnalysis.detectedDisease ? `- Detected Disease: ${this.currentAnalysis.detectedDisease}` : ''}

SUMMARY:
${this.summaryText.textContent}

RECOMMENDATIONS:
${Array.from(this.recommendationsList.querySelectorAll('p')).filter(p => p.className.includes('font-medium')).map(el => '- ' + el.textContent).join('\n')}

Generated by OCT Analysis System
                `.trim();
            }

            clearHistory() {
                if (confirm('Are you sure you want to clear all analysis history?')) {
                    this.patientHistory = [];
                    localStorage.removeItem('octHistory');
                    this.updateDashboardStats();
                    this.updateHistoryDisplay();
                }
            }
        }

        // Global functions
        function showSection(section) {
            if (window.octAnalyzer) {
                window.octAnalyzer.showSection(section);
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                location.reload();
            }
        }

        function clearHistory() {
            if (window.octAnalyzer) {
                window.octAnalyzer.clearHistory();
            }
        }

        // PWA Manager Class
        class PWAManager {
            constructor() {
                this.deferredPrompt = null;
                this.isOnline = navigator.onLine;
                this.initializePWA();
                this.setupEventListeners();
            }

            async initializePWA() {
                // Register Service Worker
                if ('serviceWorker' in navigator) {
                    try {
                        const registration = await navigator.serviceWorker.register(this.getServiceWorkerCode(), {
                            type: 'module'
                        });
                        console.log('Service Worker registered:', registration);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    this.showUpdateNotification();
                                }
                            });
                        });
                    } catch (error) {
                        console.error('Service Worker registration failed:', error);
                    }
                }

                // Setup install prompt
                this.setupInstallPrompt();
                
                // Setup notifications
                this.requestNotificationPermission();
            }

            getServiceWorkerCode() {
                const swCode = `
                    const CACHE_NAME = 'oct-analysis-v1.0.0';
                    const urlsToCache = [
                        '/',
                        'https://cdn.tailwindcss.com',
                        'https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap'
                    ];

                    // Install event - cache resources
                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => {
                                    console.log('Opened cache');
                                    return cache.addAll(urlsToCache);
                                })
                        );
                        self.skipWaiting();
                    });

                    // Fetch event - serve from cache when offline
                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => {
                                    // Return cached version or fetch from network
                                    if (response) {
                                        return response;
                                    }
                                    return fetch(event.request).catch(() => {
                                        // Return offline page for navigation requests
                                        if (event.request.mode === 'navigate') {
                                            return caches.match('/');
                                        }
                                    });
                                })
                        );
                    });

                    // Activate event - clean up old caches
                    self.addEventListener('activate', event => {
                        event.waitUntil(
                            caches.keys().then(cacheNames => {
                                return Promise.all(
                                    cacheNames.map(cacheName => {
                                        if (cacheName !== CACHE_NAME) {
                                            return caches.delete(cacheName);
                                        }
                                    })
                                );
                            })
                        );
                        self.clients.claim();
                    });

                    // Background sync for offline analysis
                    self.addEventListener('sync', event => {
                        if (event.tag === 'background-sync') {
                            event.waitUntil(doBackgroundSync());
                        }
                    });

                    // Push notifications
                    self.addEventListener('push', event => {
                        const options = {
                            body: event.data ? event.data.text() : 'Analysis complete!',
                            icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGdyYWRpZW50IGlkPSJhIiBjeD0iNjQiIGN5PSI2NCIgcj0iMjgiIGZ4PSIuMyIgZnk9Ii4zIiBmcHI9Ii4zIj48c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjMzc4ZGZmIi8+PC9ncmFkaWVudD48Y2lyY2xlIGN4PSI2NCIgY3k9IjY0IiByPSIyOCIgZmlsbD0idXJsKCNhKSIvPjx0ZXh0IHg9IjY0IiB5PSI3NiIgdHlhbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtc2l6ZT0iMjAiIGZvbnQtd2VpZ2h0PSI3MDAiPjxzdmcgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTguMTYgNi4wNEM4LjE2IDIuNzIgMi43MiA4LjE2LTIuNzIgOC4xNlMxMy40NCA2LjA0IDguMTYgNi4wNHoiIGZpbGw9IiMzNzg3ZmYiLz48L3N2Zz48L3RleHQ+PC9kZWZzPjwvc3ZnPg==',
                            badge: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGdyYWRpZW50IGlkPSJhIiBjeD0iNjQiIGN5PSI2NCIgcj0iMjgiIGZ4PSIuMyIgZnk9Ii4zIiBmcHI9Ii4zIj48c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjMzc4ZGZmIi8+PC9ncmFkaWVudD48Y2lyY2xlIGN4PSI2NCIgY3k9IjY0IiByPSIyOCIgZmlsbD0idXJsKCNhKSIvPjx0ZXh0IHg9IjY0IiB5PSI3NiIgdHlhbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtc2l6ZT0iMjAiIGZvbnQtd2VpZ2h0PSI3MDAiPjxzdmcgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTguMTYgNi4wNEM4LjE2IDIuNzIgMi43MiA4LjE2LTIuNzIgOC4xNlMxMy40NCA2LjA0IDguMTYgNi4wNHoiIGZpbGw9IiMzNzg3ZmYiLz48L3N2Zz48L3RleHQ+PC9kZWZzPjwvc3ZnPg==',
                            vibrate: [100, 50, 100],
                            data: {
                                dateOfArrival: Date.now(),
                                primaryKey: '2'
                            },
                            actions: [
                                {
                                    action: 'explore',
                                    title: 'View Results',
                                    icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGdyYWRpZW50IGlkPSJhIiBjeD0iNjQiIGN5PSI2NCIgcj0iMjgiIGZ4PSIuMyIgZnk9Ii4zIiBmcHI9Ii4zIj48c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjMzc4ZGZmIi8+PC9ncmFkaWVudD48Y2lyY2xlIGN4PSI2NCIgY3k9IjY0IiByPSIyOCIgZmlsbD0idXJsKCNhKSIvPjx0ZXh0IHg9IjY0IiB5PSI3NiIgdHlhbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtc2l6ZT0iMjAiIGZvbnQtd2VpZ2h0PSI3MDAiPjxzdmcgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTguMTYgNi4wNEM4LjE2IDIuNzIgMi43MiA4LjE2LTIuNzIgOC4xNlMxMy40NCA2LjA0IDguMTYgNi4wNHoiIGZpbGw9IiMzNzg3ZmYiLz48L3N2Zz48L3RleHQ+PC9kZWZzPjwvc3ZnPg=='
                                },
                                {
                                    action: 'close',
                                    title: 'Close',
                                    icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGdyYWRpZW50IGlkPSJhIiBjeD0iNjQiIGN5PSI2NCIgcj0iMjgiIGZ4PSIuMyIgZnk9Ii4zIiBmcHI9Ii4zIj48c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjMzc4ZGZmIi8+PC9ncmFkaWVudD48Y2lyY2xlIGN4PSI2NCIgY3k9IjY0IiByPSIyOCIgZmlsbD0idXJsKCNhKSIvPjx0ZXh0IHg9IjY0IiB5PSI3NiIgdHlhbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtc2l6ZT0iMjAiIGZvbnQtd2VpZ2h0PSI3MDAiPjxzdmcgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTguMTYgNi4wNEM4LjE2IDIuNzIgMi43MiA4LjE2LTIuNzIgOC4xNlMxMy40NCA2LjA0IDguMTYgNi4wNHoiIGZpbGw9IiMzNzg3ZmYiLz48L3N2Zz48L3RleHQ+PC9kZWZzPjwvc3ZnPg=='
                                }
                            ]
                        };

                        event.waitUntil(
                            self.registration.showNotification('OCT Analysis System', options)
                        );
                    });

                    // Notification click handler
                    self.addEventListener('notificationclick', event => {
                        event.notification.close();

                        if (event.action === 'explore') {
                            event.waitUntil(
                                clients.openWindow('/')
                            );
                        }
                    });

                    async function doBackgroundSync() {
                        // Handle background sync for offline analysis
                        console.log('Background sync triggered');
                    }
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                return URL.createObjectURL(blob);
            }

            setupEventListeners() {
                // Online/Offline status
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.hideOfflineNotification();
                });

                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    this.showOfflineNotification();
                });

                // Install prompt
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    this.deferredPrompt = e;
                    this.showInstallButton();
                });

                // App installed
                window.addEventListener('appinstalled', () => {
                    this.hideInstallButton();
                    this.showNotification('App installed successfully!', 'success');
                });

                // Update button
                const updateBtn = document.getElementById('updateBtn');
                if (updateBtn) {
                    updateBtn.addEventListener('click', () => {
                        this.updateApp();
                    });
                }
            }

            setupInstallPrompt() {
                const installBtn = document.getElementById('installBtn');
                if (installBtn) {
                    installBtn.addEventListener('click', async () => {
                        if (this.deferredPrompt) {
                            this.deferredPrompt.prompt();
                            const { outcome } = await this.deferredPrompt.userChoice;
                            
                            if (outcome === 'accepted') {
                                this.showNotification('Installing app...', 'info');
                            }
                            
                            this.deferredPrompt = null;
                            this.hideInstallButton();
                        }
                    });
                }
            }

            showInstallButton() {
                const installBtn = document.getElementById('installBtn');
                if (installBtn) {
                    installBtn.style.display = 'block';
                }
            }

            hideInstallButton() {
                const installBtn = document.getElementById('installBtn');
                if (installBtn) {
                    installBtn.style.display = 'none';
                }
            }

            showOfflineNotification() {
                const notification = document.getElementById('offlineNotification');
                if (notification) {
                    notification.style.display = 'block';
                }
            }

            hideOfflineNotification() {
                const notification = document.getElementById('offlineNotification');
                if (notification) {
                    notification.style.display = 'none';
                }
            }

            showUpdateNotification() {
                const notification = document.getElementById('updateNotification');
                if (notification) {
                    notification.style.display = 'block';
                }
            }

            hideUpdateNotification() {
                const notification = document.getElementById('updateNotification');
                if (notification) {
                    notification.style.display = 'none';
                }
            }

            async updateApp() {
                if ('serviceWorker' in navigator) {
                    const registration = await navigator.serviceWorker.getRegistration();
                    if (registration && registration.waiting) {
                        registration.waiting.postMessage({ type: 'SKIP_WAITING' });
                        window.location.reload();
                    }
                }
                this.hideUpdateNotification();
            }

            async requestNotificationPermission() {
                if ('Notification' in window && 'serviceWorker' in navigator) {
                    const permission = await Notification.requestPermission();
                    if (permission === 'granted') {
                        console.log('Notification permission granted');
                    }
                }
            }

            async showNotification(message, type = 'info') {
                if ('serviceWorker' in navigator && 'Notification' in window) {
                    const registration = await navigator.serviceWorker.getRegistration();
                    if (registration && Notification.permission === 'granted') {
                        const options = {
                            body: message,
                            icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGdyYWRpZW50IGlkPSJhIiBjeD0iNjQiIGN5PSI2NCIgcj0iMjgiIGZ4PSIuMyIgZnk9Ii4zIiBmcHI9Ii4zIj48c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjMzc4ZGZmIi8+PC9ncmFkaWVudD48Y2lyY2xlIGN4PSI2NCIgY3k9IjY0IiByPSIyOCIgZmlsbD0idXJsKCNhKSIvPjx0ZXh0IHg9IjY0IiB5PSI3NiIgdHlhbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtc2l6ZT0iMjAiIGZvbnQtd2VpZ2h0PSI3MDAiPjxzdmcgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTguMTYgNi4wNEM4LjE2IDIuNzIgMi43MiA4LjE2LTIuNzIgOC4xNlMxMy40NCA2LjA0IDguMTYgNi4wNHoiIGZpbGw9IiMzNzg3ZmYiLz48L3N2Zz48L3RleHQ+PC9kZWZzPjwvc3ZnPg==',
                            badge: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGdyYWRpZW50IGlkPSJhIiBjeD0iNjQiIGN5PSI2NCIgcj0iMjgiIGZ4PSIuMyIgZnk9Ii4zIiBmcHI9Ii4zIj48c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjMzc4ZGZmIi8+PC9ncmFkaWVudD48Y2lyY2xlIGN4PSI2NCIgY3k9IjY0IiByPSIyOCIgZmlsbD0idXJsKCNhKSIvPjx0ZXh0IHg9IjY0IiB5PSI3NiIgdHlhbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtc2l6ZT0iMjAiIGZvbnQtd2VpZ2h0PSI3MDAiPjxzdmcgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTguMTYgNi4wNEM4LjE2IDIuNzIgMi43MiA4LjE2LTIuNzIgOC4xNlMxMy40NCA2LjA0IDguMTYgNi4wNHoiIGZpbGw9IiMzNzg3ZmYiLz48L3N2Zz48L3RleHQ+PC9kZWZzPjwvc3ZnPg==',
                            vibrate: [200, 100, 200],
                            tag: type
                        };

                        registration.showNotification('OCT Analysis System', options);
                    }
                }
            }

            // Offline storage for analysis queue
            async saveOfflineAnalysis(analysisData) {
                if ('indexedDB' in window) {
                    const request = indexedDB.open('OCTAnalysisDB', 1);
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        if (!db.objectStoreNames.contains('offlineQueue')) {
                            db.createObjectStore('offlineQueue', { keyPath: 'id', autoIncrement: true });
                        }
                    };

                    request.onsuccess = (event) => {
                        const db = event.target.result;
                        const transaction = db.transaction(['offlineQueue'], 'readwrite');
                        const store = transaction.objectStore('offlineQueue');
                        store.add({
                            ...analysisData,
                            timestamp: Date.now(),
                            status: 'pending'
                        });
                    };
                }
            }

            async processOfflineQueue() {
                if (!this.isOnline) return;

                if ('indexedDB' in window) {
                    const request = indexedDB.open('OCTAnalysisDB', 1);
                    
                    request.onsuccess = (event) => {
                        const db = event.target.result;
                        const transaction = db.transaction(['offlineQueue'], 'readwrite');
                        const store = transaction.objectStore('offlineQueue');
                        
                        store.getAll().onsuccess = (event) => {
                            const pendingAnalyses = event.target.result;
                            pendingAnalyses.forEach(analysis => {
                                if (analysis.status === 'pending') {
                                    // Process the analysis
                                    this.processAnalysis(analysis);
                                    // Remove from queue
                                    store.delete(analysis.id);
                                }
                            });
                        };
                    };
                }
            }

            async processAnalysis(analysisData) {
                // Simulate processing offline analysis when back online
                console.log('Processing offline analysis:', analysisData);
                await this.showNotification('Offline analysis processed successfully!', 'success');
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            window.octAnalyzer = new OCTAnalyzer();
            window.pwaManager = new PWAManager();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'966df4da940a7dc8',t:'MTc1MzgwNjE2MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
